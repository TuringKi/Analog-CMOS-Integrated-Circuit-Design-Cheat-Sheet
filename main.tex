

\documentclass{article}
\usepackage[landscape]{geometry}
\usepackage{url}
\usepackage{multicol}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{tikz}
\usetikzlibrary{decorations.pathmorphing}
\usepackage{amsmath,amssymb}

\usepackage{colortbl}
\usepackage{xcolor}
\usepackage{mathtools}
\usepackage{amsmath,amssymb}
\usepackage{enumitem}
\usepackage{circuitikzgit}
\usetikzlibrary{fit, shapes, arrows, patterns, decorations.text, decorations.markings}


\usepackage{geometry}
 \geometry{
  a2paper
 }


\usepackage[utf8]{inputenc}

\advance\topmargin-.8in
\advance\textheight3in
\advance\textwidth3in
\advance\oddsidemargin-1.5in
\advance\evensidemargin-1.5in
\parindent0pt
\parskip2pt
\newcommand{\hr}{\centerline{\rule{3.5in}{1pt}}}
%\colorbox[HTML]{e4e4e4}{\makebox[\textwidth-2\fboxsep][l]{texto}
\begin{document}

\begin{center}{\huge{\textbf{Analog CMOS Integrated Circuit Design Cheat Sheet}}}\\
{\large By Xiao Ma (mxlol233@outlook.com)[https://github.com/TuringKi/Analog-CMOS-Integrated-Circuit-Design-Cheat-Sheet]}
\end{center}
\begin{multicols*}{3}

\tikzstyle{mybox} = [draw=black, fill=white, very thick,
    rectangle, rounded corners, inner sep=10pt, inner ysep=10pt]
\tikzstyle{fancytitle} =[fill=black, text=white, font=\bfseries]
%------------ CONTEÃšDO CAIXA RANDOM ---------------
\begin{tikzpicture}
\node [mybox] (box){%
    \begin{minipage}{0.3\textwidth}
		Process parameters ($n$,$V_{TH}$,$KP$, $V_E$):
      \begin{equation}
        t_{OX} = \frac{L_{min}}{50}
       \end{equation}
       \begin{equation}
        t_{si} = \sqrt{\frac{2\epsilon_{si}(\Phi - V_{BD})}{qN_B}}
       \end{equation}
       \begin{equation}
        C_{OX} = \frac{\bold{\epsilon}_{OX}}{t_{OX}}
       \end{equation}
       \begin{equation}
        C_{D} = \frac{\bold{\epsilon}_{si}}{t_{si}}
      \end{equation}
       \begin{equation}
        KP = \mu C_{OX}
       \end{equation}
      \begin{equation}
       \bold{\beta} = KP\frac{W}{L}
      \end{equation}
\begin{equation}
  Q_{dep} = \sqrt{4q\epsilon_{si}|\Phi_F|N_{sub}}
\end{equation}
\begin{equation}
  V_{TH0} = \Phi_{MS} + 2 \Phi_F + \frac{Q_{dep}}{C_{OX}}
\end{equation}
Changing the Gate voltage $V_{GS}$ will thus
change the conductivity of the channel and hence the current $I_{DS}$. In a similar way, changing
the Bulk voltage $V_{BS}$ will thus also change the conductivity of the channel and will thus change the
current $I_{DS}$ as well. The  gate gives the MOST operation, whereas the bulk gives JFET
operation. 

Indeed, a Junction FET is by definition a FET in which the current is controlled by
a junction capacitance.


All MOST devices are thus parallel combinations of MOSTs and JFETs.

The Bulk voltage works like a "back-gate", which is also called as "body effect":
      \begin{equation}
        V_{TH} = V_{TH0} + \gamma (\sqrt{|2\Phi_F| + V_{BS}} - \sqrt{|2\Phi_F|})
       \end{equation}
       \begin{equation}
        n = \frac{\gamma}{\sqrt{|2\Phi_F| + V_{BS}}} = 1 + \frac{C_D}{C_{OX}}
       \end{equation}
In linear region:
\begin{equation}
  I_{DS} = \beta[(V_{GS}-V_{TH})V_{DS} - \frac{1}{2}V_{DS}^2]
\end{equation}
\begin{equation}
  R_{on} = \frac{1}{\beta (V_{GS} - V_{TH})}
\end{equation}

      Channel-Length modulation in saturation region:
      \begin{equation}
        K' = \frac{KP}{2n}
      \end{equation}
      \begin{equation}
        \lambda = \frac{1}{V_E L}
      \end{equation}
      \begin{equation}
       I_{DS} =  K' \frac{W}{L}(V_{GS}-V_{TH})^2(1+\lambda V_{DS})
      \end{equation}
      \begin{equation}
        r_{o} = \frac{\partial V_{DS}}{\partial I_{DS}} \approx \frac{1}{\lambda I_{DS}} = \frac{V_E L}{I_{DS}}
      \end{equation}
Saturation region has three distinctive regions: weak-inversion (exponential region),  
strong-inversion, and velocity saturation.
 


    \end{minipage}
};
%------------ CAIXA RANDOM ---------------------
\node[fancytitle, right=10pt] at (box.north west) {Model of MOS Transistors};
\end{tikzpicture}

%------------ CONTEUDO EXEMPLO BASICO ---------------------
\begin{tikzpicture}
  \node [mybox] (box){%
      \begin{minipage}{0.3\textwidth}
\begin{center}
        \small{\begin{tabular}{lp{1.4cm} l}
          {\bf Names} & {\bf Symbols} & {\bf Values} \\
          dielectric constant of sub-silicon & $\epsilon_{si}$ & $1$ pF/cm \\ \hline
          dielectric constant of gate-oxide & $\epsilon_{OX}$ & $0.34$ pF/cm \\ \hline
          electron charge & $q$ & $1.6 \times 10^{-19}$ C \\ \hline
        minium channel length & $L_{min}$ & $0.35$ $\mu$m \\ \hline
        width of gate-oxide  & $t_{OX}$ & $0.1$ nm \\ \hline
        width of depletion layer & $t_{si}$ & $7$ nm \\ \hline
        junction built-in voltage & $\Phi$ & $0.6$ V\\ \hline
        drain-bulk voltage & $V_{BD}$ & $-3.3 $V \\ \hline
         gate-oxide capacitance & $C_{OX}$ & $0.5$ $\mu$F/cm$^2$ \\ \hline
         depletion layer capacitance & $C_{D}$ & $0.1$ $\mu$F/cm$^2$ \\ \hline
         bulk doping level & $N_B$ & $4\times10^{17}$ cm$^{-3}$ \\ \hline
         P type mobility rate & $\mu_{p}$& $250$ cm$^2$/Vs\\ \hline
         N type mobility rate & $\mu_{n}$&  $600$ cm$^2$/Vs \\ \hline
         N type KP & $KP_{n}$ &  $300$ $\mu$A/V$^2$ \\ \hline
         & $n$ &  $1.2 \cdots 1.5$ \\ \hline
         & $|2\Phi_F|$ &  $0.6$ V \\ \hline
         & $\gamma$ &  $0.5 \cdots 0.8$ V$^{\frac{1}{2}}$ \\ \hline
         N type $K'$ & $K'_{n}$ &  $100$ $\mu$A/V$^2$ \\ \hline
         P type $K'$ & $K'_{p}$ &  $40$ $\mu$A/V$^2$ \\ \hline
           & $V_{GSTt}$ &  $70$ mV \\ \hline
           & $v_{sat}$ &  $10^{7}$ cm/s \\ \hline
           & $\theta L$ &  $0.2$ $\mu$m/V \\ \hline
           
            \end{tabular}}

            
          \end{center}

            \end{minipage}
  };
  %------------ EXEMPLO BASICO BOX ---------------------
  \node[fancytitle, right=10pt] at (box.north west) {Value Examples In $0.35\mu m$ Process Nodes };
  \end{tikzpicture}


  \begin{tikzpicture}
    \node [mybox] (box){%
        \begin{minipage}{0.3\textwidth}

         \begin{equation}
          I_{DS}= I_{D0}\frac{W}{L}e^{\frac{V_{GS}}{n\frac{KT}{q}}}
         \end{equation}

  
\begin{equation}
g_{m} = \frac{\partial I_{DS}}{\partial V_{GS}} = \frac{I_{DS}}{n\frac{KT}{q}}
\end{equation}



   
  
              \end{minipage}
    };
    \node[fancytitle, right=10pt] at (box.north west) {Weak-Inversion};
    \end{tikzpicture}

    \begin{tikzpicture}
      \node [mybox] (box){%
          \begin{minipage}{0.3\textwidth}
Ignore channel-length modulation:
            \begin{equation}
              I_{DS} =  K' \frac{W}{L}(V_{GS}-V_{TH})^2
             \end{equation}

             \begin{equation}
              g_m = \frac{2I_{DS}}{V_{GS} - V_{TH}}
             \end{equation}
         

                \end{minipage}
      };
      %------------ EXEMPLO BASICO BOX ---------------------
      \node[fancytitle, right=10pt] at (box.north west) {strong-inversion};
      \end{tikzpicture}


    
        \begin{tikzpicture}
          \node [mybox] (box){%
              \begin{minipage}{0.3\textwidth}
                The voltage  and current  at transition point between weak-inversion and strong-inversion:
                \begin{equation}
                 V_{GSt} =  2n\frac{KT}{q} + V_{TH} 
                \end{equation}
                \begin{equation}
                 I_{DSt} \approx  K'\frac{W}{L} (2n\frac{KT}{q})^2  
                \end{equation}
          EKV model, a smooth model for weak-inversion and strong-inversion regions:
   
          \begin{equation}
           I_{DS} =  K' \frac{W}{L}(V_{GS}-V_{TH})^2[ ln(1+e^{\frac{V_{GS}}{V_{GSt}}}) ]^2
          \end{equation}
          Let:
          \begin{equation}
           v =  \frac{V_{GS}}{V_{GSt}}
          \end{equation}
          \begin{equation}
           i =  \frac{I_{DS}}{I_{DSt}} = [ ln(1+e^{v}) ]^2
          \end{equation}
          then,
          \begin{equation}
            v  = ln(e^{\sqrt{i}} -1)
           \end{equation}
           \begin{equation}
            V_{GS} - V_{TH}  = V_{GSTt}ln(e^{\sqrt{i}} -1)
           \end{equation}
where:
\begin{equation}
  V_{GSTt} = V_{GSt} - V_{TH} = 2n\frac{KT}{q} 
\end{equation}
          When $v=1$, $i=1$, we also have:
          \begin{equation}
           I_{DSt} = K'\frac{W}{L}(V_{GSt} - V_{TH})^2
          \end{equation}
        
                    \end{minipage}
          };
          %------------ EXEMPLO BASICO BOX ---------------------
          \node[fancytitle, right=10pt] at (box.north west) {Transition Point Between Weak-Inversion and Strong-Inversion};
          \end{tikzpicture}
    

              
        \begin{tikzpicture}
          \node [mybox] (box){%
              \begin{minipage}{0.3\textwidth}
    
                \begin{equation}
                  I_{DS} =  WC_{OX}v_{sat}(V_{GS}-V_{TH})
                 \end{equation}
                 \begin{equation}
                  g_m=  WC_{OX}v_{sat}
                 \end{equation}

        
                    \end{minipage}
          };
          %------------ EXEMPLO BASICO BOX ---------------------
          \node[fancytitle, right=10pt] at (box.north west) {Velocity Saturation};
          \end{tikzpicture}
    

              
        \begin{tikzpicture}
          \node [mybox] (box){%
              \begin{minipage}{0.3\textwidth}

               

                A smooth model for strong-inversion  and velocity saturation regions:
                \begin{equation}
                  I_{DS} = \frac{K' \frac{W}{L}(V_{GS}-V_{TH})^2}{1 + \theta (V_{GS} - V_{TH})} 
                 \end{equation}
        
                 where:
        \begin{equation}
          \theta = \frac{\mu}{2n}\frac{1}{v_{sat}L}
         \end{equation}
         $\theta L$ is constant:
         \begin{equation}
          \theta L = \frac{\mu}{2n}\frac{1}{v_{sat}}
         \end{equation}

         \begin{equation}
          g_{m,sat} =WC_{OX}v_{sat}= \frac{K'W}{\theta L}
         \end{equation}


         The voltage  and current  at transition point between strong-inversion  and velocity saturation:
         \begin{equation}
          V_{GSt} = \frac{1}{\theta} + V_{TH} = 2nL\frac{v_{sat}}{\mu} + V_{TH}
         \end{equation}
         \begin{equation}
          I_{DSt} = K'WL(2n\frac{v_{sat}}{\mu})^2
         \end{equation}


                    \end{minipage}
          };
          %------------ EXEMPLO BASICO BOX ---------------------
          \node[fancytitle, right=10pt] at (box.north west) {Transition Point Between Strong-Inversion and Velocity Saturation};
          \end{tikzpicture}
   
          
    

          \begin{tikzpicture}


            
            \node [mybox] (box){%
                \begin{minipage}{0.3\textwidth}
      
                  A system with $N$ frequency-dependent elements,  th transfer function in complex-frequency form:
                  \begin{equation}
                    H_s =  \frac{ a_0 + a_1s }{ 1+ b_1s     }
                  \end{equation}  
where:
                  \begin{equation}
                    a_0 = H^0
                   \end{equation}  
                   \begin{equation}
                    b_1 = \sum_{i=1}^{N}\tau_i^0
                   \end{equation}  
                   \begin{equation}
                    a_1 = \sum_{i=1}^{N}\tau_i^0 H^i
                   \end{equation}
                   where $H^0$ is the low-frequency gain:
                   \begin{equation}
                    H^0: C_1,C_2,\cdots,C_N = 0 
                     \end{equation}
                     or:
                     \begin{equation}
                      H^0: L_1,L_2,\cdots,L_N = 0 
                       \end{equation}
                   For capacitor:
\begin{equation}
  \tau_i^0 = C_i R_i^0 
 \end{equation}
 or for inductor:
 \begin{equation}
  \tau_i^0 = \frac{L_i}{R_i^0}
 \end{equation}    
 where $R_i^0$ is the resistance seen by the capacitor $C_i$ looking into port i with
 all other reactive elements connected to the other ports at their zero value
 (hence the superscript), namely open-circuited capacitors (and short circuited
 inductors):
 \begin{equation}
R_i^0:  C_1,C_2,C_{i -1},C_{i + 1}, \cdots, C_N = 0
 \end{equation}
 or:
 \begin{equation}
  R_i^0: L_1,L_2,\cdots,L_{i - 1}, L_{i + 1}, \cdots, L_N = 0
   \end{equation}
                
      Hight bandwidth frequency estimation by 1st-order TTCs:
      \begin{equation}
        \omega_h \approx \frac{1}{b_1 - \frac{a_1}{a_0}} = \frac{1}{\sum_{i=1}^{N}\tau_i^0(1 - \frac{H^i}{H^0})}
       \end{equation}  
Meanwhile, define:
\begin{equation}
  R_i^{\infty}:  C_1,C_2,C_{i -1},C_{i + 1}, \cdots, C_N = \infty
   \end{equation}
   or:
   \begin{equation}
    R_i^{\infty}: L_1,L_2,\cdots,L_{i - 1}, L_{i + 1}, \cdots, L_N = \infty
     \end{equation}
  
    \begin{equation}
    \tau_i^{\infty} = C_i R_i^{\infty}
    \end{equation}
    or for inductor:
    \begin{equation}
    \tau_i^{\infty} = \frac{L_i}{R_i^{\infty}}
     \end{equation} 
Low bandwidth frequency estimation:
\begin{equation}
  \omega_l \approx \sum_{i=0}^{N}\frac{1}{\tau_i^{\infty}}
  \end{equation} 
                      \end{minipage}
            };
            %------------ EXEMPLO BASICO BOX ---------------------
            \node[fancytitle, right=10pt] at (box.north west) {1st Order Time-constants and Transfer-Constants (TTCs)};
            \end{tikzpicture}




      

          \begin{tikzpicture}


            
            \node [mybox] (box){%
                \begin{minipage}{0.3\textwidth}
      
                  A system with $2$ frequency-dependent elements,  th transfer function:
                  \begin{equation}
                    H_s =  \frac{ a_0 + a_1s  +a_2s^2 }{  1+b_1s + b_2s^2     }
                  \end{equation}  
where:
                  \begin{equation}
                    a_0 = H^0
                   \end{equation}  
                   \begin{equation}
                    b_1 = \tau_1^0 + \tau_2^0
                   \end{equation}  
                   \begin{equation}
                    a_1 = \tau_1^0 H^1 + \tau_2^0 H^2
                   \end{equation}  
                   \begin{equation}
                    b_2 = \tau_1^0  \tau_2^1 = \tau_2^0 \tau_1^2 
                   \end{equation}
                   \begin{equation}
                    a_2 = \tau_1^0  \tau_2^1 H^{12} = \tau_2^0 \tau_1^2  H^{12}
                   \end{equation}
in which, $H^1$ ($H^2$) evaluated with the frequency-dependent element at the port $1$($2$) at its infinite value (i.e., shorted capacitors and
open inductors):
\begin{equation}
  H^1: C_1=\infty, C_2 = 0
\end{equation}
\begin{equation}
  H^2: C_1=0, C_2 = \infty
\end{equation}
or:
\begin{equation}
  H^1: L_1=\infty, L_2 = 0
\end{equation}
\begin{equation}
  H^2: L_1=0, L_2 = \infty
\end{equation}

                   For capacitor:
\begin{equation}
  \tau_1^0 = C_1 R_1^0 
\end{equation}
\begin{equation}
  \tau_2^0 = C_2 R_2^0
\end{equation}
\begin{equation}
  \tau_1^2 = C_1 R_1^{2} 
\end{equation} 
\begin{equation}
  \tau_2^1 = C_2 R_2^{1}  
 \end{equation}
 or for inductor:
 \begin{equation}
  \tau_1^0 = \frac{L_1} { R_1^0} 
\end{equation}
\begin{equation}
  \tau_2^0 =  \frac{L_2} {R_2^0}
\end{equation}
\begin{equation}
  \tau_1^2 =  \frac{L_1} { R_1^{2} }
\end{equation} 
\begin{equation}
  \tau_2^1 =  \frac{L_2} {R_2^{1}  }
 \end{equation}
 in which, $R_1^2$ is the resistance seen by $C_1$ (the subscript) when $C_2$ (the superscript)
 is infinite valued (shorted):
 \begin{equation}
  R_{1}^{2} : C_2 = \infty
 \end{equation}
 \begin{equation}
  R_{2}^{1} : C_1 = \infty
 \end{equation}
   or:
   \begin{equation}
    R_{1}^{2} : L_2 = \infty
   \end{equation}
   \begin{equation}
    R_{2}^{1} : L_1 = \infty
   \end{equation}                   
\end{minipage}
            };
            %------------ EXEMPLO BASICO BOX ---------------------
            \node[fancytitle, right=10pt] at (box.north west) {2nd Order Time-constants and Transfer-Constants (TTCs)};
            \end{tikzpicture}



\begin{tikzpicture}



  \node [mybox] (box){%
      \begin{minipage}{0.3\textwidth}
        Considering a common source amplifier with one load capacitor $C_L$ and one drain resistor $R_D$, 
        its low frequency voltage gain is:
        \begin{equation}
          A_v^{0} = -g_m R_D 
         \end{equation}  
From 1-st order TTCs, we have the high frequency voltage gain:
\begin{equation}
  A_v(s) = \frac{-g_m R_D}{1 + C_L R_D s} 
 \end{equation}
 and high bandwidth frequency:
 \begin{equation}
  \omega_h = \frac{1}{C_L R_D} 
 \end{equation}
 Define the bandwidth-gain product:
 \begin{equation}
\omega_u \equiv |A_v^0| \omega_h = \frac{g_m}{C_L } 
 \end{equation}
 The magnitude of the total gain for $N$ amplifiers connected 
 in series with the same gain is:
 \begin{equation}
  |A_{v, total}(s)|  =(\frac{-g_m R_D}{1 + C_L R_D s} )^N 
   \end{equation}
Let $|A_{v, total}(s)|$ equation to $\frac{1}{2}(-g_m R_D)^N$,
which is $-2 dB$ points, get the high bandwidth frequency:
\begin{equation}
  \omega_{h,total} =  \omega_{h} \sqrt{2^{\frac{1}{N}} - 1} = \frac{\omega_u}{|A_v^0|}\sqrt{2^{\frac{1}{N}} - 1} =  \frac{\omega_u}{|A_{v, total}^0|^{\frac{1}{N}}}\sqrt{2^{\frac{1}{N}} - 1}
 \end{equation}
the ratio between $N$ stages $\omega_{h,total}$ and one stage $\omega_h^{'}$ with
same gain:
\begin{equation}
\frac{\omega_{h,total}}{\omega_h^{'}} = \frac{\frac{\omega_u}{|A_{v, total}^0|^{\frac{1}{N}}}\sqrt{2^{\frac{1}{N}} - 1}}{ \frac{\omega_u}{|A_{v, total}^0|}} = |A_{v, total}^0|^{1 - \frac{1}{N}}\sqrt{2^{\frac{1}{N}} - 1}
\end{equation}
The stages number $N_{opt}$ where the $\frac{\omega_{h,total}}{\omega_h^{'}}$ is maximum:
\begin{equation}
  N_{opt} \approx 1.85 ln(|A_{v, total}^0|)
   \end{equation}
The optimal gain for each of the stages:
\begin{equation}
  A_{v,opt}^0 = e -1
   \end{equation}

            \end{minipage}
  };
  %------------ EXEMPLO BASICO BOX ---------------------
  \node[fancytitle, right=10pt] at (box.north west) {Bandwith-gain Product And Optimal Stages};
  \end{tikzpicture}

          \begin{tikzpicture}


            
            \node [mybox] (box){%
                \begin{minipage}{0.3\textwidth}

                A system with $N$ frequency-dependent elements,  th transfer function:
                \begin{equation}
                  H_s =  \frac{ a_0 + a_1s + a_2s^2  \cdots +a_ns^n +\cdots  }{1+ b_1s  + b_2s^2 \cdots +b_ns^n +\cdots     }
                \end{equation}  
           where:
           \begin{equation}
           a_0 = H^0
          \end{equation}  
          \begin{equation}
            b_1 = \sum_{i=1}^{N}\tau_i^0
           \end{equation}  
           \begin{equation}
            a_1 = \sum_{i=1}^{N}\tau_i^0 H^i
           \end{equation}
           \begin{equation}
            b_2 = \sum_{i=1}^{i< j} \sum_{j=i+1}^{j\leq N} \tau_i^0 \tau_j^i
           \end{equation}  
           \begin{equation}
            a_2 = \sum_{i=1}^{i< j} \sum_{j=i+1}^{j\leq N} \tau_i^0 \tau_j^i H^{ij}
           \end{equation}
           \begin{equation}
            b_n = \sum_{i=1}^{i< j} \sum_{j=i+1}^{j<k} \sum_{k=j+1\cdots}^{k<...\leq N} \tau_i^0 \tau_j^i \tau_k^{ij} \cdots
           \end{equation}  
           \begin{equation}
            a_n = \sum_{i=1}^{i< j} \sum_{j=i+1}^{j<k} \sum_{k=j+1\cdots}^{k<...\leq N} \tau_i^0 \tau_j^i \tau_k^{ij} \cdots H^{ijk...}
           \end{equation}  
        

and for capacitor:
\begin{equation}
  \tau_i^0 = C_i R_i^0 
 \end{equation}
 \begin{equation}
  \tau_i^{jk\cdots} =C_i R_i^{jk\cdots} 
 \end{equation} 
 or for inductor:
 \begin{equation}
  \tau_i^0 = \frac{L_i}{R_i^0}
 \end{equation}    
 \begin{equation}
  \tau_i^{jk\cdots} =\frac{L_i} {R_i^{jk\cdots}} 
 \end{equation} 
                In the form of zeros and poles:
                \begin{equation}
                  H_s = a_0 \frac{ (1-\frac{s}{z_1}) (1-\frac{s}{z_1}) \cdots (1-\frac{s}{z_m})   }{  (1-\frac{s}{p_1}) (1-\frac{s}{p_1}) \cdots (1-\frac{s}{p_n})    }
                \end{equation}  
  
                      \end{minipage}
            };
            %------------ EXEMPLO BASICO BOX ---------------------
            \node[fancytitle, right=10pt] at (box.north west) {General Time-constants and Transfer-Constants (TTCs)};
            \end{tikzpicture}


          \begin{tikzpicture}


            
            \node [mybox] (box){%
                \begin{minipage}{0.3\textwidth}
                  Common Source, with resistance $R_D$:
  \begin{center}

                  \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
                   
                    \coordinate (D) at (4.1,2.4);
                    \coordinate (G) at (3,1.4);
                    \coordinate (S) at (4.1,0.4);
                    \coordinate (out) at (5.1,2.4);
                    \coordinate (V_{out}) at (6.1,2.4);
                    \coordinate (in) at (2,1.4);
                    \coordinate (V_{in}) at (0,1.4);
                    \coordinate (1) at (4.1,4.4);
                    \coordinate (0) at (4.1,0);
                    \coordinate (2) at (4.1,4.42);
                   \ctikzset{tripoles/mos style/arrows}
                    \draw (4.1,1.4) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
                    \draw (M1.D) -- (D) (M1.G) -- (G) (M1.S) -- (S);
                    \draw[-] (out) to (V_{out});
                    \draw (in) to [R, bipoles/length=0.75cm, l_={${R_1}$}, n=R1] (V_{in});
                    \draw[-] (D) to (out);
                    \draw (D) to [R, bipoles/length=0.90cm, l_={${R_D}$}, n=RD] (1);
                    \draw[-] (S) to (0);
                    \draw[-] (1) to (2);
                    \draw[-] (G) to (in);
                    \draw (D) node[circ] {};
                    \draw (G) node[circ] {};
                    \draw (S) node[circ] {};
                    \draw (V_{out}) node[ocirc] {};
                    \draw (V_{in}) node[ocirc] {};
                    \draw (0) node[sground] {};
                    \draw (2) node[rground, rotate=180] {};
                    \draw[anchor=west] (4.3,4.92) node {$V_{\mathrm{DD}}$};
                    \draw[anchor=south east] (out) node {out};
                    \draw[anchor=south east] (V_{out}) node {V$_{\mathrm{{out}}}$};
                    \draw[anchor=south east] (in) node {in};
                    \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};


                  \end{tikzpicture}
               
  \end{center} 
  Transfer function of voltage gain in low-frequency:
      \begin{equation}
        A_{v}^0 =\frac{V_{out}}{V_{in}}= -g_mR_{D}
      \end{equation}
      consider channel-length modulation:
      \begin{equation}
        A_{v}^0  =\frac{V_{out}}{V_{in}}= -g_mR_{D} || r_o = -g_m\frac{R_D r_o}{R_D + r_o}
      \end{equation}
      The equivalent resistance at point $out$ look down $M1$:
      \begin{equation}
        R_{out} = r_o
      \end{equation}
  Consider high-frequency gain with $3$ capacitors $c_{\pi}, c_{\mu}, c_{L}$:

    \begin{center} 
      \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
   
        \coordinate (D) at (4.1,2.4);
        \coordinate (G) at (3,1.4);
        \coordinate (S) at (4.1,0.4);
        \coordinate (out) at (5.1,2.4);
        \coordinate (V_{out}) at (6.1,2.4);
        \coordinate (in) at (2,1.4);
        \coordinate (V_{in}) at (0,1.4);
        \coordinate (1) at (4.1,4.4);
        \coordinate (0) at (4.1,0);
        \coordinate (2) at (4.1,4.42);
        \coordinate (3) at (2,0.4);
        \coordinate (5) at (2,2.4);
        \coordinate (7) at (3.05,2.4);
        \coordinate (4) at (2,-0);
        \coordinate (10) at (5.1,1.4);
        \coordinate (11) at (5.1,1);
       \ctikzset{tripoles/mos style/arrows}
        \draw (4.1,1.4) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
        \draw (M1.D) -- (D) (M1.G) -- (G) (M1.S) -- (S);
        \draw[-] (out) to (V_{out});
        \draw (in) to [R, bipoles/length=0.75cm, l_={${R_1}$}, n=R1] (V_{in});
        \draw[-] (D) to (out);
        \draw (D) to [R, bipoles/length=0.90cm, l_={${R_D}$}, n=RD] (1);
        \draw[-] (S) to (0);
        \draw[-] (1) to (2);
        \draw[-] (G) to (in);
        \draw[color=red] (in) to [C, bipoles/length=0.90cm, l_={${C_{\pi}}$}, n=C0] (3);
        \draw[-] (in) to (5);
        \draw[color=red] (5) to [C, bipoles/length=0.90cm, l_={${C_{\mu}}$}, n=C1] (7);
        \draw[-] (7) to (D);
        \draw[-] (3) to (4);
        \draw[color=red] (out) to [C, bipoles/length=0.90cm, l_={${C_{L}}$}, n=C2] (10);
        \draw[-] (10) to (11);
        \draw (D) node[circ] {};
        \draw (G) node[circ] {};
        \draw (S) node[circ] {};
        \draw (out) node[circ] {};
        \draw (V_{out}) node[ocirc] {};
        \draw (in) node[circ] {};
        \draw (V_{in}) node[ocirc] {};
        \draw (0) node[sground] {};
        \draw (2) node[rground, rotate=180] {};
        \draw[anchor=west] (4.3,4.92) node {$V_{\mathrm{DD}}$};
        \draw (4) node[sground] {};
        \draw (11) node[sground] {};
        \draw[anchor=south east] (out) node {out};
        \draw[anchor=south east] (V_{out}) node {V$_{\mathrm{{out}}}$};
        \draw[anchor=south east] (in) node {in};
        \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};

      \end{tikzpicture}
    \end{center} 

    \begin{equation}
      \tau_{\pi}^0 =  C_{\pi} R_1 
    \end{equation}
    \begin{equation}
      \tau_{\mu}^0 =  C_{\mu} (R_{left} + R_{right} + G_m R_{left} R_{right} )=C_{\mu} (R_1 + R_D + g_m R_1 R_D )
    \end{equation}
    \begin{equation}
      \tau_{L}^{0} =  C_{L} R_D
    \end{equation}
    \begin{equation}
      \tau_{\mu}^{\pi} =  C_{\mu} R_D
    \end{equation}
    \begin{equation}
      \tau_{\pi}^{L} =  C_{\pi} R_1
    \end{equation}
    \begin{equation}
      \tau_{\mu}^{L} =  C_{\mu} R_1
    \end{equation}
    \begin{equation}
      \tau_{\mu}^{\pi L} = \tau_{L}^{\pi \mu} =  0
    \end{equation}
    \begin{equation}
      A_v^{\pi} = H^{L} = 0
    \end{equation}
    \begin{equation}
      A_v^{\mu} = \frac{r_m || R_D}{R_1 + r_m || R_D} = \frac{R_D}{R_1 + R_D + g_m R_1 R_D}
    \end{equation}
    \begin{equation}
      A_v^{\pi \mu} =  A_v^{L \mu} =A_v^{L \pi} =0
    \end{equation}
    \begin{equation}
     a_0 = A_{v}^0
    \end{equation}
     \begin{equation}
      b_1 = \tau_{\pi}^{0} + \tau_{\mu}^{0} + \tau_{L}^{0} = R_1[C_{\pi} + C_{\mu}(1+g_m R_D)] + R_D(C_{\mu} + C_L)
     \end{equation}
     \begin{equation}
      a_1 = \tau_{\pi}^{0} A_v^{\pi}+ \tau_{\mu}^{0} A_v^{\mu} + \tau_{L}^{0}A_v^{L} = C_{\mu} R_D
     \end{equation}
     \begin{equation}
      b_2 = \tau_{\pi}^{0} \tau_{\mu}^{\pi} + \tau_{L}^{0} \tau_{\mu}^{L} +\tau_{L}^0 \tau_{\pi}^{L} = R_1 R_D(C_{\mu}C_{\pi} + C_{\mu}C_{L} + C_{\pi}C_L) = R_{left}R_{right} (\Delta C)^2
     \end{equation}
     \begin{equation}
      a_2 = \tau_{\pi}^{0} \tau_{\mu}^{\pi} A_v^{\pi \mu}+ \tau_{L}^{0} \tau_{\mu}^{L} A_v^{L \mu} +\tau_{L}^0 \tau_{\pi}^{L} A_v^{L \pi} = 0
     \end{equation}
     \begin{equation}
      b_3 = \tau_{\pi}^{0} \tau_{\mu}^{\pi} \tau_{L}^{\pi \mu} = 0
     \end{equation}
     \begin{equation}
      a_3 = \tau_{\pi}^{0} \tau_{\mu}^{\pi} \tau_{L}^{\pi \mu} A_v^{\pi \mu L} = 0
     \end{equation}
     Finally, we have:
     \begin{equation}
      A_{v}(s) = \frac{A_v^0(1 - r_m C_{\mu} s)}{ 1+[R_1[C_{\pi} + C_{\mu}(1+g_m R_D)] + R_D(C_{\mu} + C_L)]s +R_1 R_D(C_{\mu}C_{\pi} + C_{\mu}C_{L} + C_{\pi}C_L)s^2 }
     \end{equation}
                      \end{minipage}
            };
            %------------ EXEMPLO BASICO BOX ---------------------
            \node[fancytitle, right=10pt] at (box.north west) {Single Stage Amplifier: Common Source (CS), with Resistive Load};
            \end{tikzpicture}
  
            \begin{tikzpicture}


            
              \node [mybox] (box){%
                  \begin{minipage}{0.3\textwidth}
                    Common Source, with resistance $R_D$ and $R_S$:
\begin{center}

  \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
  

    \coordinate (D) at (4.1,3.4);
    \coordinate (G) at (3,2.4);
    \coordinate (S) at (4.1,1.4);
    \coordinate (out) at (5.1,3.4);
    \coordinate (V_{out}) at (6.1,3.4);
    \coordinate (in) at (2,2.4);
    \coordinate (V_{in}) at (0,2.4);
    \coordinate (1) at (4.1,5.4);
    \coordinate (3) at (4.1,0.4);
    \coordinate (0) at (4.1,0);
    \coordinate (2) at (4.1,5.42);
   \ctikzset{tripoles/mos style/arrows}
    \draw (4.1,2.4) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
    \draw (M1.D) -- (D) (M1.G) -- (G) (M1.S) -- (S);
    \draw[-] (out) to (V_{out});
    \draw (in) to [R, bipoles/length=0.75cm, l_={${R_1}$}, n=R1] (V_{in});
    \draw[-] (D) to (out);
    \draw (D) to [R, bipoles/length=0.90cm, l_={${R_D}$}, n=RD] (1);
    \draw (S) to [R, bipoles/length=0.75cm, l_={${R_S}$}, n=RS] (3);
    \draw[-] (3) to (0);
    \draw[-] (1) to (2);
    \draw[-] (G) to (in);
    \draw (D) node[circ] {};
    \draw (G) node[circ] {};
    \draw (S) node[circ] {};
    \draw (V_{out}) node[ocirc] {};
    \draw (V_{in}) node[ocirc] {};
    \draw (0) node[sground] {};
    \draw (2) node[rground, rotate=180] {};
    \draw[anchor=west] (4.3,5.92) node {$V_{\mathrm{DD}}$};
    \draw[anchor=south east] (out) node {out};
    \draw[anchor=south east] (V_{out}) node {V$_{\mathrm{{out}}}$};
    \draw[anchor=south east] (in) node {in};
    \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};

  \end{tikzpicture}


                  \end{center}
                  The low frequency gain:
  \begin{equation}
    A_{v}^{0} = -\frac{g_m R_D}{1 + g_m R_S}
  \end{equation}
  The equivalent transconductance:
  \begin{equation}
    G_m = \frac{g_m}{1 + g_m R_S}
  \end{equation}
  consider channel-length modulation and body effect:
  \begin{equation}
    G_m = \frac{g_m r_o}{R_S + [1 + (g_m + g_{mb})R_s]r_o}
  \end{equation}
  \begin{equation}
    R_{out} = r_o + [1 + (g_m + g_{mb})r_o]R_S \approx g_m r_o R_S
  \end{equation}
  \begin{equation}
    A_v^0 = -G_m(R_{out} || R_D) = - \frac{g_m r_o}{R_S + [1 + (g_m + g_{mb})R_s]r_o} \{[r_o + [1 + (g_m + g_{mb})r_o]R_S] || R_D \} 
  \end{equation}
   
                        \end{minipage}
              };
              %------------ EXEMPLO BASICO BOX ---------------------
              \node[fancytitle, right=10pt] at (box.north west) {Single Stage Amplifier: Common Source (CS), with Source Degeneration};
              \end{tikzpicture}

              \begin{tikzpicture}


            
                \node [mybox] (box){%
                    \begin{minipage}{0.3\textwidth}
  
  
                      Common Source, with diode-connected transistor $M2$:
  
                      \begin{center}

    \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
      \coordinate (D) at (4.1,2.4);
      \coordinate (G) at (3,1.4);
      \coordinate (S) at (4.1,0.4);
      \coordinate (out) at (5.1,2.4);
      \coordinate (V_{out}) at (6.1,2.4);
      \coordinate (in) at (2,1.4);
      \coordinate (V_{in}) at (0,1.4);
      \coordinate (S2) at (4.1,2.8);
      \coordinate (G2) at (3,3.8);
      \coordinate (3) at (2.6,3.8);
      \coordinate (4) at (2.6,5.2);
      \coordinate (5) at (4.1,5.2);
      \coordinate (D2) at (4.1,4.8);
      \coordinate (0) at (4.1,0);
      \coordinate (2) at (4.1,5.6);
     \ctikzset{tripoles/mos style/arrows}
      \draw (4.1,1.4) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
      \draw (M1.D) -- (D) (M1.G) -- (G) (M1.S) -- (S);
      \draw[-] (out) to (V_{out});
      \draw (in) to [R, bipoles/length=0.75cm, l_={${R_1}$}, n=R1] (V_{in});
      \draw[-] (D) to (out);
      \draw[-] (D) to (S2);
      \draw[-] (G2) to (3);
      \draw[-] (3) to (4);
      \draw[-] (4) to (5);
      \draw (4.1,3.8) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M2) {$M_{2}$};
      \draw (M2.D) -- (D2) (M2.G) -- (G2) (M2.S) -- (S2);
      \draw[-] (S) to (0);
      \draw[-] (D2) to (5);
      \draw[-] (5) to (2);
      \draw[-] (G) to (in);
      \draw (D) node[circ] {};
      \draw (G) node[circ] {};
      \draw (S) node[circ] {};
      \draw (V_{out}) node[ocirc] {};
      \draw (V_{in}) node[ocirc] {};
      \draw (5) node[circ] {};
      \draw (0) node[sground] {};
      \draw (2) node[rground, rotate=180] {};
      \draw[anchor=west] (4.3,6.1) node {$V_{\mathrm{DD}}$};
      \draw[anchor=south east] (out) node {out};
      \draw[anchor=south east] (V_{out}) node {V$_{\mathrm{{out}}}$};
      \draw[anchor=south east] (in) node {in};
      \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};
    \end{tikzpicture}


  \end{center}
Consider body effect and channel-length modulation, the equivalent resistance at point $out$ look into $M2$: 
\begin{equation}
  R_{out,up} = \frac{1}{g_{m2} + g_{mb2}} || r_o
\end{equation}
With negligible channel-length modulation, we have the low frequency gain:
\begin{equation}
  A_v^0 = -g_{m1} \frac{1}{g_{m2} + g_{mb2}} = - \frac{g_{m1}}{g_{m2}} \frac{1}{1 + \eta}
\end{equation}
where:
\begin{equation}
\frac{1}{1 + \eta} = \frac{g_{mb2}}{g_{m2}}
\end{equation}
Since $I_{DS}$ is same  at $M1$ and $M2$ (from drain to source), we have:
\begin{equation}
  A_v^0 = - \sqrt{\frac{W_1 / L_1}{W_2 / L_2} } \frac{1}{1 + \eta}
  \end{equation} 
  If we replace nmos $M2$ with pmos, the body effect of $M2$ will disappear:
  \begin{equation}
    A_v^0 = - \sqrt{\frac{\mu_n  W_1 / L_1}{\mu_p W_2 / L_2} }
    \end{equation} 
                          \end{minipage}
                };
                %------------ EXEMPLO BASICO BOX ---------------------
                \node[fancytitle, right=10pt] at (box.north west) {Single Stage Amplifier: Common Source (CS), with Diode-Connected Load};
                \end{tikzpicture}



    
                
                \begin{tikzpicture}


            
                  \node [mybox] (box){%
                      \begin{minipage}{0.3\textwidth}
    $M2$ works as a current source:
                        \begin{center}


                          \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
                            \coordinate (D) at (4.1,2.4);
                            \coordinate (G) at (3,1.4);
                            \coordinate (S) at (4.1,0.4);
                            \coordinate (out) at (5.1,2.4);
                            \coordinate (V_{out}) at (6.1,2.4);
                            \coordinate (G2) at (3,3.8);
                            \coordinate (V_{b}) at (2,3.8);
                            \coordinate (in) at (2,1.4);
                            \coordinate (V_{in}) at (0,1.4);
                            \coordinate (S2) at (4.1,2.8);
                            \coordinate (D2) at (4.1,4.8);
                            \coordinate (0) at (4.1,0);
                            \coordinate (5) at (4.1,5.2);
                            \coordinate (2) at (4.1,5.6);
                           \ctikzset{tripoles/mos style/arrows}
                            \draw (4.1,1.4) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
                            \draw (M1.D) -- (D) (M1.G) -- (G) (M1.S) -- (S);
                            \draw[-] (out) to (V_{out});
                            \draw[-] (G2) to (V_{b});
                            \draw (in) to [R, bipoles/length=0.75cm, l_={${R_1}$}, n=R1] (V_{in});
                            \draw[-] (D) to (out);
                            \draw[-] (D) to (S2);
                            \draw (4.1,3.8) node[pmos, , xscale=1.0, yscale=1.0, rotate=0] (M2) {$M_{2}$};
                            \draw (M2.D) -- (S2) (M2.G) -- (G2) (M2.S) -- (D2);
                            \draw[-] (S) to (0);
                            \draw[-] (D2) to (5);
                            \draw[-] (5) to (2);
                            \draw[-] (G) to (in);
                            \draw (D) node[circ] {};
                            \draw (G) node[circ] {};
                            \draw (S) node[circ] {};
                            \draw (V_{out}) node[ocirc] {};
                            \draw (V_{b}) node[ocirc] {};
                            \draw (V_{in}) node[ocirc] {};
                            \draw (0) node[sground] {};
                            \draw (2) node[rground, rotate=180] {};
                            \draw[anchor=west] (4.3,6.1) node {$V_{\mathrm{DD}}$};
                            \draw[anchor=south east] (out) node {out};
                            \draw[anchor=south east] (V_{out}) node {V$_{\mathrm{{out}}}$};
                            \draw[anchor=south east] (G2) node {G2};
                            \draw[anchor=south east] (V_{b}) node {V$_{\mathrm{{b}}}$};
                            \draw[anchor=south east] (in) node {in};
                            \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};
                          \end{tikzpicture}
                        
                        
                        \end{center}
The low frequency gain:                    
                        \begin{equation}
                          A_v^0 = - g_{m1}(r_{o1} || r_{o2})
                          \end{equation} 

      
                            \end{minipage}
                  };
                  %------------ EXEMPLO BASICO BOX ---------------------
                  \node[fancytitle, right=10pt] at (box.north west) {Single Stage Amplifier: Common Source (CS), with Current-Source Load};
                  \end{tikzpicture}
    

                  \begin{tikzpicture}


            
                    \node [mybox] (box){%
                        \begin{minipage}{0.3\textwidth}
      
      
\begin{center}

  \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
    \coordinate (D) at (4.1,2.4);
    \coordinate (G) at (3,1.4);
    \coordinate (S) at (4.1,0.4);
    \coordinate (out) at (5.1,2.4);
    \coordinate (V_{out}) at (6.1,2.4);
    \coordinate (in) at (2,1.4);
    \coordinate (V_{in}) at (0,1.4);
    \coordinate (S2) at (4.1,2.8);
    \coordinate (G2) at (2,3.8);
    \coordinate (D2) at (4.1,4.8);
    \coordinate (0) at (4.1,0);
    \coordinate (5) at (4.1,5.2);
    \coordinate (2) at (4.1,5.6);
   \ctikzset{tripoles/mos style/arrows}
    \draw (4.1,1.4) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
    \draw (M1.D) -- (D) (M1.G) -- (G) (M1.S) -- (S);
    \draw[-] (out) to (V_{out});
    \draw (in) to [R, bipoles/length=0.75cm, l_={${R_1}$}, n=R1] (V_{in});
    \draw[-] (D) to (out);
    \draw[-] (D) to (S2);
    \draw (4.1,3.8) node[pmos, , xscale=1.0, yscale=1.0, rotate=0] (M2) {$M_{2}$};
    \draw (M2.D) -- (S2) (M2.G) -- (G2) (M2.S) -- (D2);
    \draw[-] (G2) to (in);
    \draw[-] (S) to (0);
    \draw[-] (D2) to (5);
    \draw[-] (5) to (2);
    \draw[-] (G) to (in);
    \draw (D) node[circ] {};
    \draw (G) node[circ] {};
    \draw (S) node[circ] {};
    \draw (V_{out}) node[ocirc] {};
    \draw (in) node[circ] {};
    \draw (V_{in}) node[ocirc] {};
    \draw (0) node[sground] {};
    \draw (2) node[rground, rotate=180] {};
    \draw[anchor=west] (4.3,6.1) node {$V_{\mathrm{DD}}$};
    \draw[anchor=south east] (out) node {out};
    \draw[anchor=south east] (V_{out}) node {V$_{\mathrm{{out}}}$};
    \draw[anchor=south east] (in) node {in};
    \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};
  \end{tikzpicture}

\end{center}
The low frequency gain:                    
                        \begin{equation}
                          A_v^0 = - (g_{m1} + g_{m2} )(r_{o1} || r_{o2})
                          \end{equation} 
        
                              \end{minipage}
                    };
                    %------------ EXEMPLO BASICO BOX ---------------------
                    \node[fancytitle, right=10pt] at (box.north west) {Single Stage Amplifier: Common Source (CS), with Active Load};
                    \end{tikzpicture}



                    \begin{tikzpicture}


            
                      \node [mybox] (box){%
                          \begin{minipage}{0.3\textwidth}
        

                            \begin{center}
                            \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
                              \coordinate (D) at (4.1,3.4);
                              \coordinate (G) at (3,2.4);
                              \coordinate (S) at (4.1,1.4);
                              \coordinate (V_{out}) at (5.1,1.4);
                              \coordinate (in) at (2,2.4);
                              \coordinate (V_{in}) at (0,2.4);
                              \coordinate (3) at (4.1,0.4);
                              \coordinate (0) at (4.1,0);
                              \coordinate (2) at (4.1,3.6);
                             \ctikzset{tripoles/mos style/arrows}
                              \draw (4.1,2.4) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
                              \draw (M1.D) -- (D) (M1.G) -- (G) (M1.S) -- (S);
                              \draw[-] (S) to (V_{out});
                              \draw (in) to [R, bipoles/length=0.75cm, l_={${R_1}$}, n=R1] (V_{in});
                              \draw (S) to [R, bipoles/length=0.75cm, l_={${R_S}$}, n=RS] (3);
                              \draw[-] (3) to (0);
                              \draw[-] (D) to (2);
                              \draw[-] (G) to (in);
                              \draw (D) node[circ] {};
                              \draw (G) node[circ] {};
                              \draw (S) node[circ] {};
                              \draw (V_{out}) node[ocirc] {};
                              \draw (V_{in}) node[ocirc] {};
                              \draw (0) node[sground] {};
                              \draw (2) node[rground, rotate=180] {};
                              \draw[anchor=west] (4.3,4.1) node {$V_{\mathrm{DD}}$};
                              \draw[anchor=south east] (V_{out}) node {V$_{\mathrm{{out}}}$};
                              \draw[anchor=south east] (in) node {in};
                              \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};
                            \end{tikzpicture}
                          \end{center}
                          The low frequency gain:                    
                          \begin{equation}
                            A_v^0 =  \frac{g_m R_S}{1 + (g_{m} + g_{mb})R_S}
                            \end{equation} 
        The equivalent resistance at point $out$ look up into $M1$:
        \begin{equation}
          R_{out, up} =  \frac{1}{g_m + g_{mb}} || r_o
          \end{equation} 

          Consider high-frequency gain with $3$ capacitors:
\begin{center}

  \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
    \coordinate (D) at (5,3.8);
    \coordinate (G) at (3,2.8);
    \coordinate (S) at (5,1.8);
    \coordinate (out) at (6,1.8);
    \coordinate (V_{out}) at (7,1.8);
    \coordinate (in) at (2,2.8);
    \coordinate (V_{in}) at (0,2.8);
    \coordinate (3) at (5,0.8);
    \coordinate (0) at (5,0.4);
    \coordinate (2) at (5,4);
    \coordinate (6) at (3,3.8);
    \coordinate (7) at (4,3.8);
    \coordinate (8) at (3,1.8);
    \coordinate (9) at (4,1.8);
    \coordinate (10) at (6,1.4);
    \coordinate (11) at (6,0.4);
    \coordinate (12) at (6,0);
   \ctikzset{tripoles/mos style/arrows}
    \draw (5,2.8) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
    \draw (M1.D) -- (D) (M1.G) -- (G) (M1.S) -- (S);
    \draw[-] (S) to (out);
    \draw[-] (out) to (V_{out});
    \draw (in) to [R, bipoles/length=0.75cm, l_={${R_1}$}, n=R1] (V_{in});
    \draw (S) to [R, bipoles/length=0.75cm, l_={${R_S}$}, n=RS] (3);
    \draw[-] (3) to (0);
    \draw[-] (D) to (2);
    \draw[-] (G) to (in);
    \draw[-] (G) to (6);
    \draw[color=red] (6) to [C, bipoles/length=0.75cm, l_={${C_{\mu}}$}, n=C1] (7);
    \draw[-] (7) to (D);
    \draw[-] (G) to (8);
    \draw[color=red] (8) to [C, bipoles/length=0.75cm, l_={${C_{\pi}}$}, n=C2] (9);
    \draw[-] (9) to (S);
    \draw[-] (out) to (10);
    \draw[color=red] (10) to [C, bipoles/length=0.75cm, l_={${C_{L}}$}, n=C3] (11);
    \draw[-] (11) to (12);
    \draw (D) node[circ] {};
    \draw (G) node[circ] {};
    \draw (S) node[circ] {};
    \draw (out) node[circ] {};
    \draw (V_{out}) node[ocirc] {};
    \draw (V_{in}) node[ocirc] {};
    \draw (0) node[sground] {};
    \draw (2) node[rground, rotate=180] {};
    \draw[anchor=west] (5.2,4.5) node {$V_{\mathrm{DD}}$};
    \draw (12) node[sground] {};
    \draw[anchor=south east] (out) node {out};
    \draw[anchor=south east] (V_{out}) node {V$_{\mathrm{{out}}}$};
    \draw[anchor=south east] (in) node {in};
    \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};
  \end{tikzpicture}


\end{center}
We have:
\begin{equation}
\tau_{\mu}^{0} = C_{\mu} R_1
\end{equation}
\begin{equation}
  \tau_{\pi}^{0} = C_{\pi} \frac{R_1 + R_S}{1 + g_m R_S}
  \end{equation}
  \begin{equation}
    \tau_{L}^{0} = C_L (r_m || R_S)
    \end{equation}
    \begin{equation}
      \tau_{L}^{\pi} = C_L (R_1 || R_S)
      \end{equation}
      \begin{equation}
        \tau_{\mu}^{L} = C_L R_1
        \end{equation}    
        \begin{equation}
    A_v^{\mu} = A_v^{L} = 0
          \end{equation}
\begin{equation}
  A_v^{\pi} = \frac{R_S}{R_1 + R_S}
\end{equation}
\begin{equation}
  b_1 = C_{\mu}R_1 + C_{\pi} \frac{R_1 + R_S}{1 + g_m R_S} + C_L (r_m || R_S)
\end{equation}
\begin{equation}
  a_1 = C_{\pi} \frac{1}{1 + g_m R_S}
\end{equation} 
\begin{equation}
  b_2 =  \frac{R_1 R_S}{1 + g_m R_S}(C_{\pi} C_{\mu} + C_{\pi} C_L) + C_{L} C_{\mu} (r_m || R_S) R_1
\end{equation}
\begin{equation}
a_2 = b_3 = a_3 = 0
\end{equation}
We ignore body effect:
\begin{equation}
  a_0 =  \frac{g_m R_S}{1 + g_m R_S}
\end{equation} 
Now we have the high frequency voltage gain in $s$ domain:
\begin{equation}
A_v(s) = \frac{g_m R_S + C_{\pi}s}{1 + g_m R_S + [(C_{\mu}g_m R_1 + C_{\pi} + C_L)R_S + (C_{\mu} + C_{\pi})R_1]s + R_1 R_S \Delta C^2 s^2} 
\end{equation}
where,
\begin{equation}
  \Delta C^2 = C_{\mu} C_{\pi} + C_{\pi} C_L +   C_{\mu} C_L
\end{equation}
        \end{minipage}
                      };
                      %------------ EXEMPLO BASICO BOX ---------------------
                      \node[fancytitle, right=10pt] at (box.north west) {Single Stage Amplifier: Common Drain (CD) or Source Follower};
                      \end{tikzpicture}


                      \begin{tikzpicture}


            
                        \node [mybox] (box){%
                            \begin{minipage}{0.3\textwidth}
          
                              \begin{center}

                                \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
                                  
                              
                                  \coordinate (D) at (4.1,2.4);
                                  \coordinate (G) at (3,1.4);
                                  \coordinate (S) at (4.1,0.4);
                                  \coordinate (out) at (5.1,2.4);
                                  \coordinate (V_{out}) at (6.1,2.4);
                                  \coordinate (V_{b}) at (2,1.4);
                                  \coordinate (in) at (2,3.8);
                                  \coordinate (V_{in}) at (0,3.8);
                                  \coordinate (S2) at (4.1,2.8);
                                  \coordinate (D2) at (4.1,4.8);
                                  \coordinate (G2) at (3,3.8);
                                  \coordinate (0) at (4.1,0);
                                  \coordinate (5) at (4.1,5.2);
                                  \coordinate (2) at (4.1,5.6);
                                 \ctikzset{tripoles/mos style/arrows}
                                  \draw (4.1,1.4) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M2) {$M_{2}$};
                                  \draw (M2.D) -- (D) (M2.G) -- (G) (M2.S) -- (S);
                                  \draw[-] (out) to (V_{out});
                                  \draw[-] (G) to (V_{b});
                                  \draw (in) to [R, bipoles/length=0.75cm, l_={${R_1}$}, n=R1] (V_{in});
                                  \draw[-] (D) to (out);
                                  \draw[-] (D) to (S2);
                                  \draw (4.1,3.8) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
                                  \draw (M1.D) -- (D2) (M1.G) -- (G2) (M1.S) -- (S2);
                                  \draw[-] (S) to (0);
                                  \draw[-] (D2) to (5);
                                  \draw[-] (5) to (2);
                                  \draw[-] (G2) to (in);
                                  \draw (D) node[circ] {};
                                  \draw (G) node[circ] {};
                                  \draw (S) node[circ] {};
                                  \draw (V_{out}) node[ocirc] {};
                                  \draw (V_{b}) node[ocirc] {};
                                  \draw (V_{in}) node[ocirc] {};
                                  \draw (0) node[sground] {};
                                  \draw (2) node[rground, rotate=180] {};
                                  \draw[anchor=west] (4.3,6.1) node {$V_{\mathrm{DD}}$};
                                  \draw[anchor=south east] (out) node {out};
                                  \draw[anchor=south east] (V_{out}) node {V$_{\mathrm{{out}}}$};
                                  \draw[anchor=south east] (V_{b}) node {V$_{\mathrm{{b}}}$};
                                  \draw[anchor=south east] (in) node {in};
                                  \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};
                              
                                \end{tikzpicture}
                              
                              \end{center}
                              The low frequency gain:                    
                              \begin{equation}
                                A_v^0 =  \frac{R_{eq}}{R_{eq} + \frac{1}{g_{m1}}}
                                \end{equation} 
where:
\begin{equation}
  R_{eq} = \frac{1}{g_{mb1}}|| r_{o1} || r_{o2}
  \end{equation}
            
                                  \end{minipage}
                        };
                        %------------ EXEMPLO BASICO BOX ---------------------
                        \node[fancytitle, right=10pt] at (box.north west) {Single Stage Amplifier: Common Drain (CD) or Source Follower, With Transistor Load};
                        \end{tikzpicture}



                        \begin{tikzpicture}


            
                          \node [mybox] (box){%
                              \begin{minipage}{0.3\textwidth}
            $M_2$ works as current source, $C_1$ is  coupled capacitor:
\begin{center}
  \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
    \coordinate (D) at (3,2.4);
    \coordinate (G) at (1.9,1.4);
    \coordinate (S) at (3,0.4);
    \coordinate (in) at (1,2.4);
    \coordinate (V_{in}) at (0,2.4);
    \coordinate (G2) at (1.9,3.8);
    \coordinate (V_{b1}) at (0.9,3.8);
    \coordinate (V_{b2}) at (0.9,1.4);
    \coordinate (out) at (3,4.8);
    \coordinate (V_{out}) at (4,4.8);
    \coordinate (0) at (2,2.4);
    \coordinate (S2) at (3,2.8);
    \coordinate (5) at (3,5.2);
    \coordinate (6) at (3,6.2);
    \coordinate (2) at (3,6.6);
    \coordinate (0_split0) at (3,0);
   \ctikzset{tripoles/mos style/arrows}
    \draw (3,1.4) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M2) {$M_{2}$};
    \draw (M2.D) -- (D) (M2.G) -- (G) (M2.S) -- (S);
    \draw[-] (in) to (V_{in});
    \draw[-] (G2) to (V_{b1});
    \draw[-] (G) to (V_{b2});
    \draw[-] (out) to (V_{out});
    \draw[-] (D) to (0);
    \draw[-] (D) to (S2);
    \draw (0) to [C, l_=$C_{1}$, n=C1] (in);
    \draw (3,3.8) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
    \draw (M1.D) -- (out) (M1.G) -- (G2) (M1.S) -- (S2);
    \draw[-] (S) to (0_split0);
    \draw[-] (out) to (5);
    \draw (5) to [R, bipoles/length=0.75cm, l_=$R_{D}$, n=RD] (6);
    \draw[-] (6) to (2);
    \draw (D) node[circ] {};
    \draw (G) node[circ] {};
    \draw (S) node[circ] {};
    \draw (V_{in}) node[ocirc] {};
    \draw (V_{b1}) node[ocirc] {};
    \draw (V_{b2}) node[ocirc] {};
    \draw (out) node[circ] {};
    \draw (V_{out}) node[ocirc] {};
    \draw (0_split0) node[sground] {};
    \draw (2) node[rground, rotate=180] {};
    \draw[anchor=west] (3.2,7.1) node {$V_{\mathrm{DD}}$};
    \draw[anchor=south east] (in) node {in};
    \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};
    \draw[anchor=south east] (G2) node {G2};
    \draw[anchor=south east] (V_{b1}) node {V$_{\mathrm{{b1}}}$};
    \draw[anchor=south east] (V_{b2}) node {V$_{\mathrm{{b2}}}$};
    \draw[anchor=south east] (out) node {out};
    \draw[anchor=south east] (V_{out}) node {V$_{\mathrm{{out}}}$};
  \end{tikzpicture}

\end{center}
The low frequency voltage gain:
\begin{equation}
  A_v^0 = g_m(1+\eta)R_D
\end{equation}
              
                                    \end{minipage}
                          };
                          %------------ EXEMPLO BASICO BOX ---------------------
                          \node[fancytitle, right=10pt] at (box.north west) {Single Stage Amplifier: Common Gate (CG)};
                          \end{tikzpicture}
            


                          \begin{tikzpicture}


            
                            \node [mybox] (box){%
                                \begin{minipage}{0.3\textwidth}
            $M_3$ and $M_4$ are formed the cascode current source:
                                  \begin{center}
                \begin{tikzpicture}[scale=0.8, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
                
                  \coordinate (D) at (2.1,2.4);
                  \coordinate (G) at (1,1.4);
                  \coordinate (S) at (2.1,0.4);
                  \coordinate (G2) at (1,3.8);
                  \coordinate (V_{b2}) at (0,3.8);
                  \coordinate (V_{in}) at (0,1.4);
                  \coordinate (G3) at (1,6.8);
                  \coordinate (V_{b3}) at (0,6.8);
                  \coordinate (G4) at (1,8.8);
                  \coordinate (V_{b4}) at (0,8.8);
                  \coordinate (out) at (2.1,4.8);
                  \coordinate (V_{out}) at (3.1,4.8);
                  \coordinate (S2) at (2.1,2.8);
                  \coordinate (0) at (2.1,0);
                  \coordinate (5) at (2.1,5.8);
                  \coordinate (6) at (2.1,7.8);
                  \coordinate (7) at (2.1,9.8);
                  \coordinate (2) at (2.1,10.8);
                 \ctikzset{tripoles/mos style/arrows}
                  \draw (2.1,1.4) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
                  \draw (M1.D) -- (D) (M1.G) -- (G) (M1.S) -- (S);
                  \draw[-] (G2) to (V_{b2});
                  \draw[-] (G) to (V_{in});
                  \draw[-] (G3) to (V_{b3});
                  \draw[-] (G4) to (V_{b4});
                  \draw[-] (out) to (V_{out});
                  \draw[-] (D) to (S2);
                  \draw (2.1,3.8) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M2) {$M_{2}$};
                  \draw (M2.D) -- (out) (M2.G) -- (G2) (M2.S) -- (S2);
                  \draw[-] (S) to (0);
                  \draw[-] (out) to (5);
                  \draw (2.1,6.8) node[pmos, , xscale=1.0, yscale=1.0, rotate=0] (M3) {$M_{3}$};
                  \draw (M3.D) -- (5) (M3.G) -- (G3) (M3.S) -- (6);
                  \draw (2.1,8.8) node[pmos, , xscale=1.0, yscale=1.0, rotate=0] (M4) {$M_{4}$};
                  \draw (M4.D) -- (6) (M4.G) -- (G4) (M4.S) -- (7);
                  \draw[-] (7) to (2);
                  \draw (D) node[circ] {};
                  \draw (G) node[circ] {};
                  \draw (S) node[circ] {};
                  \draw (V_{b2}) node[ocirc] {};
                  \draw (V_{in}) node[ocirc] {};
                  \draw (V_{b3}) node[ocirc] {};
                  \draw (V_{b4}) node[ocirc] {};
                  \draw (out) node[circ] {};
                  \draw (V_{out}) node[ocirc] {};
                  \draw (0) node[sground] {};
                  \draw (2) node[rground, rotate=180] {};
                  \draw[anchor=west] (2.3,11.3) node {$V_{\mathrm{DD}}$};
                  \draw[anchor=south east] (G2) node {G2};
                  \draw[anchor=south east] (V_{b2}) node {V$_{\mathrm{{b2}}}$};
                  \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};
                  \draw[anchor=south east] (G3) node {G3};
                  \draw[anchor=south east] (V_{b3}) node {V$_{\mathrm{{b3}}}$};
                  \draw[anchor=south east] (G4) node {G4};
                  \draw[anchor=south east] (V_{b4}) node {V$_{\mathrm{{b4}}}$};
                  \draw[anchor=south east] (out) node {out};
                  \draw[anchor=south east] (V_{out}) node {V$_{\mathrm{{out}}}$};


                \end{tikzpicture}
              \end{center}
              The low frequency voltage gain:
              \begin{equation}
                A_v^0 \approx -g_{m1} ( g_{m2}r_{o1} r_{o2} || g_{m3}r_{o3}r_{o4})
              \end{equation}
                
                                      \end{minipage}
                            };
                            %------------ EXEMPLO BASICO BOX ---------------------
                            \node[fancytitle, right=10pt] at (box.north west) {Single Stage Amplifier: Cascode};
                            \end{tikzpicture}
              



\begin{tikzpicture}



\node [mybox] (box){%
\begin{minipage}{0.3\textwidth}
  We consider the output impedance at $out$ looking upon:
  \begin{center}
    \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
      \coordinate (D) at (5,2);
      \coordinate (G) at (3,1);
      \coordinate (S) at (5,0);
      \coordinate (out) at (6,0);
      \coordinate (in) at (2,1);
      \coordinate (V_{in}) at (0,1);
      \coordinate (2) at (5,2.2);
      \coordinate (6) at (3,2);
      \coordinate (7) at (4,2);
      \coordinate (8) at (3,0);
      \coordinate (9) at (4,0);
     \ctikzset{tripoles/mos style/arrows}
      \draw (5,1) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
      \draw (M1.D) -- (D) (M1.G) -- (G) (M1.S) -- (S);
      \draw[-] (S) to (out);
      \draw (in) to [R, bipoles/length=0.75cm, l_={${R_1}$}, n=R1] (V_{in});
      \draw[-] (D) to (2);
      \draw[-] (G) to (6);
      \draw[color=red] (6) to [C, bipoles/length=0.75cm, l_={${C_{\mu}}$}, n=C1] (7);
      \draw[-] (7) to (D);
      \draw[-] (G) to (8);
      \draw[color=red] (8) to [C, bipoles/length=0.75cm, l_={${C_{\pi}}$}, n=C2] (9);
      \draw[-] (9) to (S);
      \draw[-] (G) to (in);
      \draw (D) node[circ] {};
      \draw (G) node[circ] {};
      \draw (S) node[circ] {};
      \draw (out) node[ocirc] {};
      \draw (V_{in}) node[ocirc] {};
      \draw (2) node[rground, rotate=180] {};
      \draw[anchor=west] (5.2,2.7) node {$V_{\mathrm{DD}}$};
      \draw[anchor=south east] (out) node {out};
      \draw[anchor=south east] (in) node {in};
      \draw[anchor=south east] (V_{in}) node {V$_{\mathrm{{in}}}$};
    \end{tikzpicture}

  \end{center}
\begin{equation}
  \tau_{\mu} = C_{\mu} R_1
\end{equation}
\begin{equation}
  \tau_{\pi} = C_{\pi} r_m
\end{equation}
\begin{equation}
  \tau_{\mu}^{\pi} = C_{\mu} R_1
\end{equation}
\begin{equation}
  Z_{out}^0 = r_m
\end{equation}
\begin{equation}
  Z_{out}^{\mu} = r_m
\end{equation}
\begin{equation}
  Z_{out}^{\pi} = R_1
\end{equation}
\begin{equation}
  Z_{out}^{\pi \mu} = 0
\end{equation}

\begin{equation}
  Z_{out}(s) = r_m \frac{1 + (C_{\mu} + C_{\pi})R_1 s}{1 + (C_{\mu}R_1 + C_{\pi}r_m) s + C_{\pi} C_{\mu} R_1 r_m s^2}
\end{equation}

Consider the input impedance at $in$ looking right.
\begin{center}
  \begin{tikzpicture}[scale=1.00, transform shape, /tikz/circuitikz/bipoles/length=1.50cm, american currents, american voltages, voltage dir=RP]
    \coordinate (D) at (3,4.8);
    \coordinate (G) at (1,3.8);
    \coordinate (S) at (3,2.8);
    \coordinate (in) at (0,3.8);
    \coordinate (2) at (3,5);
    \coordinate (8) at (1,2.8);
    \coordinate (9) at (2,2.8);
    \coordinate (11) at (3,1.8);
    \coordinate (12) at (3,1.4);
    \coordinate (13) at (3,0.4);
    \coordinate (14) at (3,0);
   \ctikzset{tripoles/mos style/arrows}
    \draw (3,3.8) node[nmos, , xscale=1.0, yscale=1.0, rotate=0] (M1) {$M_{1}$};
    \draw (M1.D) -- (D) (M1.G) -- (G) (M1.S) -- (S);
    \draw[-] (G) to (in);
    \draw[-] (D) to (2);
    \draw[-] (G) to (8);
    \draw[color=red] (8) to [C, bipoles/length=0.75cm, l_={${C_{\pi}}$}, n=C2] (9);
    \draw[-] (9) to (S);
    \draw[color=red] (S) to [C, bipoles/length=0.75cm, l_={${C_{L}}$}, n=C1] (11);
    \draw[-] (11) to (12);
    \draw (12) to [R, bipoles/length=0.75cm, l_={${R_S}$}, n=R_s] (13);
    \draw[-] (13) to (14);
    \draw (D) node[circ] {};
    \draw (G) node[circ] {};
    \draw (S) node[circ] {};
    \draw (in) node[ocirc] {};
    \draw (2) node[rground, rotate=180] {};
    \draw[anchor=west] (3.2,5.5) node {$V_{\mathrm{DD}}$};
    \draw (14) node[sground] {};
    \draw[anchor=south east] (in) node {in};
  \end{tikzpicture}
\end{center}
\begin{equation}
  \tau_{\pi} = C_{\pi} r_m
\end{equation}
\begin{equation}
  \tau_{L} = C_{L} (r_m + R_S)
\end{equation}
\begin{equation}
  \tau_{L}^{\pi} = C_{\mu} R_S
\end{equation}
We analysis the conductance $Y_{in}$ first:
\begin{equation}
  Y_{in}^0 = Y_{in}^{\pi} = Y_{in}^{L} = 0
\end{equation}
\begin{equation}
  Y_{in}^0 = Y_{in}^{\pi} = Y_{in}^{L} = 0
\end{equation}
\begin{equation}
  Y_{in}^{L \mu} = \frac{1}{R_S}
\end{equation}
we have:
\begin{equation}
  Z_{in}(s) = \frac{1}{Y_{in}(s)} = \frac{ 1 + [C_{\pi}r_m + C_L(r_m +R_S)]s + C_{\mu} C_{L} r_m R_S s^2}{ C_{\pi}C_L r_m s^2 }
\end{equation}
when $R_S \to 0$:
\begin{equation}
  Z_{in}(s) =  \frac{ 1 + (C_{\pi} + C_L)r_m s}{ C_{\pi}C_L r_m s^2 } = \frac{1}{(C_L || C_{\pi})s } + \frac{g_m}{C_L C_{\pi} s^2}
\end{equation}
\end{minipage}
};
%------------ EXEMPLO BASICO BOX ---------------------
\node[fancytitle, right=10pt] at (box.north west) {Input and Output Impedance At High Frequency of Source Follower};
\end{tikzpicture}




 \begin{tikzpicture}


            
              \node [mybox] (box){%
                  \begin{minipage}{0.3\textwidth}
                    The idea asymptotic transfer function:
                    \begin{equation}
                      H_{\infty} = H |_{k \to \infty} = \lim_{k \to \infty}\frac{kA}{ 1 + kAf} = \frac{1}{f}
                    \end{equation}
 In $s$ domain:
 \begin{equation}
  H(s) = \frac{kA(s)}{ 1 + kA(s)f} 
\end{equation}
let $s=j\omega$, if $|A(j\omega)f| \gg 1$:
\begin{equation}
  H(s) = \frac{1}{f}
\end{equation}
$|A(j\omega)f| \ll 1$:
\begin{equation}
  H(s) = A(s)
\end{equation}
This indicates that the transfer function is very stable when the amplitude is large, 
and the transfer function is independent of feedback when the amplitude is small.

Given an open loop transfer function:
\begin{equation}
  A(s) = \frac{A_0}{1 + \tau_1 s}
\end{equation}
in the middle (not too large and not too small):
\begin{equation}
  H(s) = \frac{A_0}{1 + A_0f}\frac{1}{1 + \frac{\tau_1}{1 + A_0 f}s}
\end{equation}
we have an equivalent $\tau'_1$:
\begin{equation}
  \tau'_1 =\frac{\tau_1}{1 + A_0 f}
\end{equation}
Transfer function sensitivity:
\begin{equation}
  \frac{\Delta H}{H} = \frac{\Delta A}{A} \frac{1}{1 + Af}
\end{equation}
\begin{equation}
  \frac{\Delta H}{H} = \frac{\Delta f}{f} \frac{Af}{1 + Af}
\end{equation}
That is to say, when the gain A is large enough, 
the sensitivity of the transfer function is mainly determined by the feedback part.

Given an nonlinear transfer function $g$, and let:
\begin{equation}
 y = g[A(x - fy)]
\end{equation}
which means:
\begin{equation}
  x = fy + \frac{g^{-1}(y)}{A}
 \end{equation}
if $A$ is large enough,
\begin{equation}
  \frac{y}{x} = \frac{1}{f} = H_{\infty}
 \end{equation}
 that says, the feedback can make output and input to be linear. 

For certain source device, we define the asymptotic transfer function:
\begin{equation}
  H = H_{\infty}\frac{T}{1 + T} + H_0 \frac{1}{1 + T}
 \end{equation}
 where $T$ is the return ratio of this source, And
 \begin{equation}
  H_{0} = H |_{k \to 0}
 \end{equation}

 Blackman Formula:
 \begin{equation}
  Z = Z_0\frac{1 + T_{sc}}{ 1 + T_{oc}}
 \end{equation}

Serial makes impedance up.

Shunt makes impedance down.


Loop gain:
\begin{equation}
  \bold{T} = - \frac{u_y}{u_x} 
 \end{equation}
for Unilateral:
 \begin{equation}
  \frac{1}{\bold{T}} = \frac{1}{\bold{T_v}} + \frac{1}{\bold{T_i}}
 \end{equation}
 Bilateral:
 \begin{equation}
  \frac{1}{\bold{T}} = \frac{1}{\bold{T_v}} + \frac{1}{\bold{T_i}} + \frac{\bold{T_{i, revert}}}{\bold{T_{v, forward}}}
 \end{equation}
\end{minipage}
              };
              %------------ EXEMPLO BASICO BOX ---------------------
              \node[fancytitle, right=10pt] at (box.north west) {Feedback};
              \end{tikzpicture}



\begin{tikzpicture}


\node [mybox] (box){%
\begin{minipage}{0.3\textwidth}
For a feedback system, the close loop gain:
\begin{equation}
  A_f = \frac{A}{ 1+ A f} =   \frac{A}{ 1+ \bold{T}}   
 \end{equation}
where $\bold{T}$ is the loop gain.

We assume the open loop gain $A$ has no poles and zeros in RHP, 
then the stability of feedback system is determined by 
the roots of 
$1+ \bold{T} =0$.

If one of the roots is located in RHP, the system is unstable.

Nyquist criteria: 
if the polar plot of $ 1+ \bold{T}$ encircles the origin, then the polar plot of $\bold{T}$ 
encircles the
point $(-1, 0)$ because the latter is obtained by shifting the former to the left by one unit.
Nyquist's theorem articulates this result as for a closed-loop system, $\frac{A}{ 1+ \bold{T}} $, 
to be stable,
the polar plot of $\bold{T}$  must not encircle the point $(-1, 0)$  clockwise as $s$
traverses a contour around the
critical region clockwise.

The condition of feedback system is unstable:
\begin{equation}
  \bold{T} = -1
 \end{equation}
which implies:
\begin{equation}
  \bold{T}(j\omega)|_{\omega = \theta} = e^{j\theta}
 \end{equation}
where $\theta = \pi $.
Now we consider phase margin and gain margin. 

Suppose $\theta_m$ is the phase margin about $\pi$ when the amplitude is $1$:
\begin{equation}
  \bold{T} = e^{\theta_m - \pi} = -e^{\theta_m }
 \end{equation}
 then we have:
 \begin{equation}
  A_f(j\omega) = \frac{1}{f} \frac{\bold{T}}{ 1 + \bold{T}} = A_{\infty}\frac{e^{\theta_m }}{e^{\theta_m }-1}
 \end{equation}
 the amplitude:
 \begin{equation}
  |A_f(j\omega)|^2 = \frac{A_{\infty}^2}{ 2(1 - cos(\theta_m))} \approx \frac{A_{\infty}^2}{\theta_m^2}
 \end{equation}
 \begin{equation}
  |A_f(j\omega)| \approx \frac{A_{\infty}}{\theta_m}
 \end{equation}
\end{minipage}
};
%------------ EXEMPLO BASICO BOX ---------------------
\node[fancytitle, right=10pt] at (box.north west) {Stability and Frequency Compensation };
\end{tikzpicture}



            % \begin{tikzpicture}


            
            %   \node [mybox] (box){%
            %       \begin{minipage}{0.3\textwidth}

  
            %             \end{minipage}
            %   };
            %   %------------ EXEMPLO BASICO BOX ---------------------
            %   \node[fancytitle, right=10pt] at (box.north west) {Single Stage Amplifier: Common Drain (CD) or Source Follower};
            %   \end{tikzpicture}


\end{multicols*}
\end{document}
